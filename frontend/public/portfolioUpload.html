<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UniTopia AI 升學輔助系統 - 學習歷程</title>
    <link rel="stylesheet" href="../css/portfolioUpload.css">
    <!-- Font Awesome CDN for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>    
    <!-- 主要內容區域 -->
    <div class="main-content">
        <div class="content-container">
            <div class="page-header">
                <h1 class="page-title">學習歷程</h1>
            </div>
            
            <div class="portfolio-container">
                <!-- 左側類別選擇 -->
                <div class="portfolio-sidebar">
                    <h3 class="category-title">志願學校系所</h3>
                    <ul class="category-list">
                        <li class="category-item active" data-category="all">
                            <i class="fas fa-list"></i> 所有文件
                        </li>
                        <li class="category-item" data-category="ntu-csie">
                            <i class="fas fa-university"></i> 臺灣大學-資訊工程學系
                        </li>
                        <li class="category-item" data-category="nthu-cs">
                            <i class="fas fa-university"></i> 清華大學-資訊工程學系
                        </li>
                        <li class="category-item" data-category="nctu-cs">
                            <i class="fas fa-university"></i> 交通大學-資訊工程學系
                        </li>
                        <li class="category-item" data-category="ntnu-mis">
                            <i class="fas fa-university"></i> 政治大學-資訊管理學系
                        </li>
                        <li class="category-item" data-category="ncku-csie">
                            <i class="fas fa-university"></i> 成功大學-資訊工程學系
                        </li>
                        <li class="category-item" data-category="ncu-cs">
                            <i class="fas fa-university"></i> 中央大學-資訊工程學系
                        </li>
                    </ul>
                </div>
                
                <!-- 右側內容 -->
                <div class="portfolio-content">
                    <!-- 上傳區域 -->
                    <div class="upload-section" id="uploadArea">
                        <div class="upload-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <h3 class="upload-title">上傳你的學習歷程文件</h3>
                        <p class="upload-subtitle">支持 PDF、Word、PPT、圖片等格式，最大 20MB</p>
                        <button class="upload-button" id="uploadBtn">
                            <i class="fas fa-plus"></i> 選擇文件
                        </button>
                        <input type="file" id="fileUpload" style="display: none;" multiple>
                    </div>
                    
                    <!-- 上傳配置模態框 -->
                    <div class="modal" id="uploadModal">
                        <div class="modal-content" style="max-width: 500px;">
                            <div class="modal-header">
                                <h3 class="modal-title">設定文件屬性</h3>
                                <button class="close-btn" id="closeUploadModal">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="modal-body">
                                <div class="upload-form">
                        <div class="form-group">
                                        <label for="schoolSelect">選擇志願學校系所：</label>
                                        <select id="schoolSelect" class="form-control">
                                            <option value="">請選擇學校系所...</option>
                                            <option value="ntu-csie">臺灣大學-資訊工程學系</option>
                                            <option value="nthu-cs">清華大學-資訊工程學系</option>
                                            <option value="nctu-cs">交通大學-資訊工程學系</option>
                                            <option value="ntnu-mis">政治大學-資訊管理學系</option>
                                            <option value="ncku-csie">成功大學-資訊工程學系</option>
                                            <option value="ncu-cs">中央大學-資訊工程學系</option>
                                        </select>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label>選擇文件類型：</label>
                                        <div class="radio-group">
                                            <label class="radio-label">
                                                <input type="radio" name="documentType" value="learning" checked>
                                                <span>學習歷程自述</span>
                                            </label>
                                            <label class="radio-label">
                                                <input type="radio" name="documentType" value="diversity">
                                                <span>多元表現</span>
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label>選擇的文件：</label>
                                        <div id="selectedFileName" class="selected-file-name">尚未選擇文件</div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label>最終檔案名稱：</label>
                                        <div id="finalFileName" class="final-file-name">-</div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button class="modal-btn btn-secondary" id="cancelUpload">取消</button>
                                <button class="modal-btn btn-primary" id="confirmUpload">確認上傳</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 文件列表 -->
                    <div class="files-section">
                        <div class="section-header">
                            <h3 class="section-title">所有文件</h3>
                        </div>
                        
                        <ul class="files-list">
                            <li class="file-item" data-school="ntu-csie" data-type="learning">
                                <div class="checkbox-container">
                                    <input type="radio" name="fileSelect" id="file1">
                                </div>
                                <div class="file-icon">
                                    <i class="fas fa-file-pdf"></i>
                                </div>
                                <div class="file-details">
                                    <div class="file-name">臺灣大學-資訊工程學系-學習歷程自述.pdf</div>
                                    <div class="file-meta">4.2 MB · 上傳於 2025/03/18</div>
                                </div>
                                <span class="file-status status-analyzed">已分析 · 2025/03/19 · 評分: 92</span>
                                <button class="delete-btn">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </li>
                            
                            <li class="file-item" data-school="ntu-csie" data-type="diversity">
                                <div class="checkbox-container">
                                    <input type="radio" name="fileSelect" id="file2">
                                </div>
                                <div class="file-icon">
                                    <i class="fas fa-file-pdf"></i>
                                </div>
                                <div class="file-details">
                                    <div class="file-name">臺灣大學-資訊工程學系-多元表現.pdf</div>
                                    <div class="file-meta">3.8 MB · 上傳於 2025/03/18</div>
                                </div>
                                <span class="file-status status-analyzed">已分析 · 2025/03/19 · 評分: 90</span>
                                <button class="delete-btn">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </li>
                            
                            <li class="file-item" data-school="nthu-cs" data-type="learning">
                                <div class="checkbox-container">
                                    <input type="radio" name="fileSelect" id="file3">
                                </div>
                                <div class="file-icon">
                                    <i class="fas fa-file-word"></i>
                                </div>
                                <div class="file-details">
                                    <div class="file-name">清華大學-資訊工程學系-學習歷程自述.docx</div>
                                    <div class="file-meta">1.8 MB · 上傳於 2025/03/15</div>
                                </div>
                                <span class="file-status status-analyzed">已分析 · 2025/03/16 · 評分: 88</span>
                                <button class="delete-btn">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </li>
                            
                            <li class="file-item" data-school="nthu-cs" data-type="diversity">
                                <div class="checkbox-container">
                                    <input type="radio" name="fileSelect" id="file4">
                                </div>
                                <div class="file-icon">
                                    <i class="fas fa-file-word"></i>
                                </div>
                                <div class="file-details">
                                    <div class="file-name">清華大學-資訊工程學系-多元表現.docx</div>
                                    <div class="file-meta">2.1 MB · 上傳於 2025/03/15</div>
                                </div>
                                <span class="file-status status-analyzed">已分析 · 2025/03/16 · 評分: 85</span>
                                <button class="delete-btn">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </li>
                            
                            <li class="file-item" data-school="ntnu-mis" data-type="learning">
                                <div class="checkbox-container">
                                    <input type="radio" name="fileSelect" id="file5">
                                </div>
                                <div class="file-icon">
                                    <i class="fas fa-file-powerpoint"></i>
                                </div>
                                <div class="file-details">
                                    <div class="file-name">政治大學-資訊管理學系-學習歷程自述.pptx</div>
                                    <div class="file-meta">6.5 MB · 上傳於 2025/03/10</div>
                                </div>
                                <span class="file-status status-pending">待分析</span>
                                <button class="delete-btn">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </li>
                            
                            <li class="file-item" data-school="nctu-cs" data-type="learning">
                                <div class="checkbox-container">
                                    <input type="radio" name="fileSelect" id="file6">
                                </div>
                                <div class="file-icon">
                                    <i class="fas fa-file-pdf"></i>
                                </div>
                                <div class="file-details">
                                    <div class="file-name">交通大學-資訊工程學系-學習歷程自述.pdf</div>
                                    <div class="file-meta">3.9 MB · 上傳於 2025/03/08</div>
                                </div>
                                <span class="file-status status-pending">待分析</span>
                                <button class="delete-btn">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </li>
                        </ul>
                        
                        <div class="analyze-footer">
                            <button class="analysis-button" id="analyzeBtn">
                                <i class="fas fa-robot"></i> AI 分析所選文件
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 上傳區域點擊處理
            document.getElementById('uploadBtn').addEventListener('click', function() {
                // 顯示上傳配置模態框
                document.getElementById('uploadModal').classList.add('active');
            });
            
            // 關閉上傳模態框
            document.getElementById('closeUploadModal').addEventListener('click', function() {
                document.getElementById('uploadModal').classList.remove('active');
            });
            
            document.getElementById('cancelUpload').addEventListener('click', function() {
                document.getElementById('uploadModal').classList.remove('active');
            });
            
            // 處理上傳模態框中的選擇變更
            const schoolSelect = document.getElementById('schoolSelect');
            const radioButtons = document.querySelectorAll('input[name="documentType"]');
            
            function updateFinalFileName() {
                const schoolValue = schoolSelect.value;
                const typeValue = document.querySelector('input[name="documentType"]:checked').value;
                const selectedFile = document.getElementById('selectedFileName').textContent;
                
                if (schoolValue && typeValue && selectedFile !== '尚未選擇文件') {
                    // 獲取選中的學校系所顯示名稱
                    const schoolDeptName = schoolSelect.options[schoolSelect.selectedIndex].text;
                    
                    // 獲取文件類型顯示名稱
                    let typeName = '';
                    if (typeValue === 'learning') {
                        typeName = '學習歷程自述';
                    } else if (typeValue === 'diversity') {
                        typeName = '多元表現';
                    }
                    
                    // 獲取原始文件的擴展名
                    const fileExt = selectedFile.split('.').pop();
                    
                    // 生成最終文件名
                    const finalName = `${schoolDeptName}-${typeName}.${fileExt}`;
                    document.getElementById('finalFileName').textContent = finalName;
                } else {
                    document.getElementById('finalFileName').textContent = '-';
                }
            }
            
            // 綁定變更事件
            schoolSelect.addEventListener('change', updateFinalFileName);
            radioButtons.forEach(button => {
                button.addEventListener('change', updateFinalFileName);
            });
            
            // 處理文件選擇
            document.getElementById('fileUpload').addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    document.getElementById('selectedFileName').textContent = e.target.files[0].name;
                    updateFinalFileName();
                }
            });
            
            // 確認上傳
            document.getElementById('confirmUpload').addEventListener('click', function() {
                const schoolValue = schoolSelect.value;
                const typeValue = document.querySelector('input[name="documentType"]:checked').value;
                const selectedFile = document.getElementById('selectedFileName').textContent;
                
                if (!schoolValue) {
                    alert('請選擇志願學校');
                    return;
                }
                
                if (selectedFile === '尚未選擇文件') {
                    // 觸發文件選擇對話框
                    document.getElementById('fileUpload').click();
                    return;
                }
                
                // 獲取最終文件名
                const finalFileName = document.getElementById('finalFileName').textContent;
                
                // 模擬上傳成功
                alert(`文件「${finalFileName}」上傳成功！`);
                document.getElementById('uploadModal').classList.remove('active');
                
                // 重置表單
                document.getElementById('selectedFileName').textContent = '尚未選擇文件';
                document.getElementById('finalFileName').textContent = '-';
                schoolSelect.value = '';
            });
            
            // 點擊「選擇文件」後打開文件選擇器
            document.getElementById('selectedFileName').addEventListener('click', function() {
                document.getElementById('fileUpload').click();
            });
            
            // 篩選學校類別
            document.querySelectorAll('.category-item').forEach(function(item) {
                item.addEventListener('click', function() {
                    // 清除所有激活狀態
                    document.querySelectorAll('.category-item').forEach(function(el) {
                        el.classList.remove('active');
                    });
                    
                    // 設置當前項為激活
                    this.classList.add('active');
                    
                    // 獲取學校類別
                    const category = this.getAttribute('data-category');
                    
                    // 更新文件部分的標題
                    const sectionTitle = document.querySelector('.section-title');
                    if (category === 'all') {
                        sectionTitle.textContent = '所有文件';
                        // 顯示所有文件
                        document.querySelectorAll('.file-item').forEach(function(file) {
                            file.style.display = 'flex';
                        });
                    } else {
                        // 獲取學校名稱
                        const schoolName = this.textContent.trim();
                        sectionTitle.textContent = schoolName + ' 申請資料';
                        
                        // 只顯示選中學校的文件
                        document.querySelectorAll('.file-item').forEach(function(file) {
                            if (file.getAttribute('data-school') === category) {
                                file.style.display = 'flex';
                            } else {
                                file.style.display = 'none';
                            }
                        });
                    }
                });
            });
            
            // 添加分析按鈕點擊事件
            document.getElementById('analyzeBtn').addEventListener('click', function() {
                const selectedFile = document.querySelector('input[name="fileSelect"]:checked');
                if (selectedFile) {
                    const fileName = selectedFile.closest('.file-item').querySelector('.file-name').textContent;
                    const fileStatus = selectedFile.closest('.file-item').querySelector('.file-status');
                    
                    // Store the analysis state
                    localStorage.setItem('currentAnalysis', JSON.stringify({
                        fileName: fileName,
                        timestamp: new Date().getTime()
                    }));
                    
                    if (fileStatus.classList.contains('status-analyzed')) {
                        if (confirm('此文件已經分析過，確定要重新分析嗎？')) {
                            window.location.href = '/initAnalysis';
                        }
                    } else {
                        window.location.href = '/initAnalysis';
                    }
                } else {
                    alert('請先選擇一個要分析的文件');
                }
            });
            
            // 添加刪除按鈕點擊事件
            document.querySelectorAll('.delete-btn').forEach(function(btn) {
                btn.addEventListener('click', function() {
                    const fileItem = this.closest('.file-item');
                    const fileName = fileItem.querySelector('.file-name').textContent;
                    
                    if (confirm('確定要刪除文件: ' + fileName + '？')) {
                        // 這裡只是模擬刪除效果
                        fileItem.style.opacity = '0';
                        setTimeout(function() {
                            fileItem.style.display = 'none';
                        }, 300);
                        alert('文件已刪除');
                    }
                });
            });
        });
    </script>