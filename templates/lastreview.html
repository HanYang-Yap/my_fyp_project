<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UniTopia - 最後整合與精修</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }

        body {
            background-color: #f0f2f5;
            color: #333;
            min-height: 100vh;
            display: flex;
        }

        /* 左側邊欄 */


        .logo-container {
            padding: 30px 25px;
        }

        .logo {
            background-color: rgba(58, 63, 75, 0.5);
            border-radius: 8px;
            padding: 15px;
            display: flex;
            align-items: center;
        }

        .logo-text {
            color: #e8eaed;
            font-size: 24px;
            font-weight: bold;
            margin-right: 10px;
        }

        .logo-icon {
            color: #8aa2aa;
            font-size: 20px;
            margin-left: auto;
        }

        .menu-container {
            padding: 0 25px;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            color: #9da3b4;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .menu-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .menu-item.active {
            background-color: rgba(255, 255, 255, 0.1);
            color: #e8eaed;
            font-weight: bold;
        }

        .menu-item svg {
            min-width: 24px;
            text-align: center;
            margin-right: 20px;
        }

        /* 主要內容區 */
        .main-content {
            margin-left: 260px;
            flex-grow: 1;
            padding: 30px;
            position: relative;
            min-height: 100vh;
        }

        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .page-title {
            font-size: 24px;
            font-weight: bold;
            color: #3a4049;
        }

        /* 分析結果區 */
        .final-analysis {
            background-color: #fff;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 30px;
            margin-bottom: 30px;
        }

        .analysis-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #f0f2f5;
        }

        .analysis-title {
            font-size: 20px;
            font-weight: bold;
            color: #3a4049;
        }

        .final-score {
            font-size: 24px;
            color: #5d8a9e;
            background-color: rgba(93, 138, 158, 0.1);
            padding: 8px 18px;
            border-radius: 30px;
            font-weight: bold;
        }

        .analysis-content {
            display: flex;
            gap: 40px;
            flex-wrap: wrap;
        }

        .chart-container {
            width: 450px;
            height: 450px;
            position: relative;
            background-color: #f9fafc;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);
        }

        .detail-container {
            flex: 1;
            min-width: 300px;
        }

        .criterion-detail {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 12px;
            background-color: #f9fafc;
            border-left: 4px solid #5d8a9e;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);
            transition: transform 0.2s ease;
        }

        .criterion-detail:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
        }

        .criterion-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .criterion-name {
            font-weight: bold;
            color: #3a4049;
            font-size: 16px;
        }

        .criterion-score {
            color: #5d8a9e;
            font-weight: bold;
            font-size: 16px;
            background-color: rgba(93, 138, 158, 0.1);
            padding: 4px 10px;
            border-radius: 20px;
        }

        .criterion-description {
            color: #636973;
            font-size: 14px;
            line-height: 1.6;
        }

        /* 總結區塊 */
        .summary-section {
            margin-top: 30px;
            padding: 20px;
            border-radius: 12px;
            background-color: #f0f5f9;
            border-left: 4px solid #5d8a9e;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .summary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .summary-title {
            font-weight: bold;
            color: #3a4049;
            font-size: 18px;
        }

        .summary-score {
            color: #5d8a9e;
            font-weight: bold;
            font-size: 18px;
            background-color: rgba(93, 138, 158, 0.1);
            padding: 5px 12px;
            border-radius: 20px;
        }

        .summary-content {
            color: #3a4049;
            font-size: 15px;
            line-height: 1.6;
        }

        /* 最終文章區域 */
        .final-document {
            background-color: #fff;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 30px;
            margin-bottom: 30px;
        }

        .document-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #f0f2f5;
        }

        .document-title {
            font-size: 20px;
            font-weight: bold;
            color: #3a4049;
            display: flex;
            align-items: center;
        }

        .document-icon {
            margin-right: 10px;
            color: #5d8a9e;
        }

        .document-content {
            color: #3a4049;
            line-height: 1.8;
            font-size: 15px;
            white-space: pre-line;
        }

        .paragraph {
            margin-bottom: 20px;
            padding: 10px;
            border-radius: 8px;
            transition: background-color 0.2s ease;
        }

        .paragraph:hover {
            background-color: #f9fafc;
        }

        /* 按鈕區域 */
        .button-container {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 30px;
        }

        .action-btn {
            padding: 12px 25px;
            border-radius: 30px;
            border: none;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
        }

        .export-button {
            background-color: #f0f2f5;
            color: #3a4049;
        }

        .export-button:hover {
            background-color: #e0e0e0;
        }

        .complete-button {
            background-color: #5d8a9e;
            color: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .complete-button:hover {
            background-color: #3a5a6a;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .action-btn svg {
            margin-left: 10px;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
</head>

<body>
    <!-- 左側邊欄 -->


    <!-- 主要內容區 -->
    <div class="main-content">
        <div class="content-header">
            <h1 class="page-title">最後整合與精修</h1>
        </div>

        <!-- 分析結果區 -->
        <div class="final-analysis">
            <div class="analysis-header">
                <div class="analysis-title">整體文章評分分析</div>
                <div class="final-score">4.4 分</div>
            </div>

            <div class="analysis-content">
                <div class="chart-container">
                    <canvas id="radarChart"></canvas>
                </div>

                <div class="detail-container">
                    <div class="criterion-detail">
                        <div class="criterion-header">
                            <div class="criterion-name">錯字&標點符號</div>
                            <div class="criterion-score">5.0</div>
                        </div>
                        <div class="criterion-description">
                            文章無錯字，標點符號使用正確且風格統一，句子流暢易讀。
                        </div>
                    </div>

                    <div class="criterion-detail">
                        <div class="criterion-header">
                            <div class="criterion-name">偏題</div>
                            <div class="criterion-score">5.0</div>
                        </div>
                        <div class="criterion-description">
                            文章完全緊扣該校系核心需求，內容深入探討管理資訊系統與經濟學的相關經歷，並能有效展現學習動機。
                        </div>
                    </div>

                    <div class="criterion-detail">
                        <div class="criterion-header">
                            <div class="criterion-name">精簡</div>
                            <div class="criterion-score">4.0</div>
                        </div>
                        <div class="criterion-description">
                            整體表達簡潔清晰，大多數段落沒有冗長敘述，但仍有部分細節可以稍作刪減，使內容更精煉。
                        </div>
                    </div>

                    <div class="criterion-detail">
                        <div class="criterion-header">
                            <div class="criterion-name">增長</div>
                            <div class="criterion-score">4.0</div>
                        </div>
                        <div class="criterion-description">
                            文章內容完整且有細節支撐，部分段落已補充專題研究與數據分析的實際應用，但還可以進一步拓展學習過程中的挑戰與解決方案。
                        </div>
                    </div>

                    <div class="criterion-detail">
                        <div class="criterion-header">
                            <div class="criterion-name">架構</div>
                            <div class="criterion-score">4.0</div>
                        </div>
                        <div class="criterion-description">
                            文章結構良好，層次分明，段落銜接自然，內容有邏輯地鋪陳，但個別轉折仍可更流暢，例如從學習經驗過渡到未來規劃的部分。
                        </div>
                    </div>

                    <!-- 總結區塊 -->
                    <div class="summary-section">
                        <div class="summary-header">
                            <div class="summary-title">總體評價</div>
                            <div class="summary-score">4.5</div>
                        </div>
                        <div class="summary-content">
                            文章涵蓋學習動機、課程經驗、專題研究、課外活動及未來發展，整體完整度高，僅部分細節可再補充，例如如何將學習經驗應用於未來目標。
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 最終文章區域 -->
        <div class="final-document">
            <div class="document-header">
                <div class="document-title">
                    <div class="document-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" stroke="#5d8a9e" fill="none">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                            <polyline points="14 2 14 8 20 8" />
                            <line x1="16" y1="13" x2="8" y2="13" />
                            <line x1="16" y1="17" x2="8" y2="17" />
                            <polyline points="10 9 9 9 8 9" />
                        </svg>
                    </div>
                    最終文章內容
                </div>
            </div>

            <div class="document-content">
                <div class="paragraph">
                    正在載入，請稍後...
                </div>
            </div>
        </div>

        <!-- 按鈕區域 -->
        <div class="button-container">
            <button class="action-btn export-button">
                匯出文件
                <svg width="16" height="16" viewBox="0 0 24 24" stroke="currentColor">
                    <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4" fill="none" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round" />
                    <polyline points="7 10 12 15 17 10" fill="none" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round" />
                    <line x1="12" y1="15" x2="12" y2="3" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round" />
                </svg>
            </button>
            <a href="index.html" id="index">
                <button class="action-btn complete-button">
                    完成修改
                    <svg width="16" height="16" viewBox="0 0 24 24" stroke="currentColor">
                        <polyline points="20 6 9 17 4 12" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round" fill="none" />
                    </svg>
                </button>
            </a>
        </div>
    </div>


</body>
<script>
    window.onload = function () {
        // 從 URL 中獲取 userId 和 fileId
        const urlParams = new URLSearchParams(window.location.search);
        const userId = urlParams.get('userId');
        const fileId = urlParams.get('fileId');

        // 檢查參數是否存在
        if (!userId || !fileId) {
            alert('缺少必要的用戶或文件標識');
            return;
        }

        // 初始化文章內容為載入中
        const documentContent = document.querySelector('.document-content');
        documentContent.innerHTML = '<div class="paragraph">正在載入文章內容，請稍候...</div>';

        // 初始化頁面狀態為生成中
        const finalScoreEl = document.querySelector('.final-score');
        const criterionDetails = document.querySelectorAll('.criterion-detail');
        const summarySection = document.querySelector('.summary-section');

        // 設置預設生成中狀態
        finalScoreEl.textContent = '正在生成中';

        criterionDetails.forEach(detail => {
            const nameEl = detail.querySelector('.criterion-name');
            const scoreEl = detail.querySelector('.criterion-score');
            const descriptionEl = detail.querySelector('.criterion-description');

            nameEl.textContent = '正在生成中';
            scoreEl.textContent = '---';
            descriptionEl.textContent = '正在分析評估文章，請稍候...';
        });

        const summaryTitle = summarySection.querySelector('.summary-title');
        const summaryScore = summarySection.querySelector('.summary-score');
        const summaryContent = summarySection.querySelector('.summary-content');

        summaryTitle.textContent = '正在生成中';
        summaryScore.textContent = '---';
        summaryContent.textContent = '正在為您的文章進行全面評估，請耐心等候。';

        // 同時發送兩個請求：取得文章內容和評估結果
        Promise.all([
            // 獲取文章全文
            fetch('http://127.0.0.1:5000/file/getFullText', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ userId, fileId })
            }),
            // 獲取評估結果
            fetch('http://127.0.0.1:5000/file/evaluation', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ userId, fileId })
            })
        ])
            .then(async ([textResponse, evaluationResponse]) => {
                // 檢查兩個響應是否正常
                if (!textResponse.ok) {
                    throw new Error('無法獲取文章內容');
                }
                if (!evaluationResponse.ok) {
                    throw new Error('無法獲取評估結果');
                }

                // 解析響應
                const textResult = await textResponse.json();
                const evaluationResult = await evaluationResponse.json();

                // 更新文章內容
                updateDocumentContent(textResult.fileContent);

                // 更新評估結果
                const { data } = evaluationResult;

                // 更新雷達圖
                updateRadarChart(data.scores.slice(0, -1)); // 排除總分

                // 更新詳細分數和描述
                updateCriterionDetails(data.scoreLabels, data.scores, data.suggestions);

                // 更新總分
                updateOverallScore(data.scores[data.scores.length - 1]);
            })
            .catch(error => {
                console.error('載入失敗:', error);
                alert('無法獲取文章內容或評估結果，請稍後再試');

                // 恢復預設提示
                documentContent.innerHTML = '<div class="paragraph">無法載入文章內容，請檢查網路連線或稍後重試。</div>';

                finalScoreEl.textContent = '無法生成';
                criterionDetails.forEach(detail => {
                    const scoreEl = detail.querySelector('.criterion-score');
                    const descriptionEl = detail.querySelector('.criterion-description');
                    scoreEl.textContent = '---';
                    descriptionEl.textContent = '評估失敗，請檢查網路連線或稍後重試。';
                });
            });

        // 更新文章內容的函數
        function updateDocumentContent(fileContent) {
            const documentContent = document.querySelector('.document-content');

            // 清空當前內容
            documentContent.innerHTML = '';

            // 按換行符分割段落
            const paragraphs = fileContent.split('\n').filter(p => p.trim() !== '');

            // 為每段創建段落元素
            paragraphs.forEach(paragraph => {
                const paragraphEl = document.createElement('div');
                paragraphEl.className = 'paragraph';
                paragraphEl.textContent = paragraph;
                documentContent.appendChild(paragraphEl);
            });
        }

        // 雷達圖更新函數（與之前相同）
        function updateRadarChart(scores) {
            const ctx = document.getElementById('radarChart').getContext('2d');

            // 圖表數據
            const data = {
                labels: ['錯字&標點符號', '偏題', '精簡', '增長', '架構'],
                datasets: [{
                    data: scores,
                    backgroundColor: 'rgba(74, 111, 165, 0.25)',
                    borderColor: 'rgba(74, 111, 165, 1)',
                    borderWidth: 2,
                    pointBackgroundColor: '#4a6fa5',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2,
                    pointRadius: 6,
                    pointHoverRadius: 8
                }]
            };

            // 圖表配置（保持原有配置）
            const config = {
                type: 'radar',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            min: 0,
                            max: 5,
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1,
                                display: true,
                                backdropColor: 'transparent',
                                color: '#555',
                                font: {
                                    size: 10
                                }
                            },
                            angleLines: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            pointLabels: {
                                display: false
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            enabled: false
                        }
                    },
                    elements: {
                        line: {
                            tension: 0.1
                        }
                    },
                    animation: {
                        duration: 1200
                    }
                }
            };

            new Chart(ctx, config);
        }

        // 更新詳細分數和描述的函數（與之前相同）
        function updateCriterionDetails(labels, scores, suggestions) {
            const detailContainer = document.querySelector('.detail-container');
            const criterionDetails = detailContainer.querySelectorAll('.criterion-detail');
            const summarySection = document.querySelector('.summary-section');

            // 更新每個評分準則
            criterionDetails.forEach((detail, index) => {
                if (index < labels.length - 1) { // 排除總分
                    const nameEl = detail.querySelector('.criterion-name');
                    const scoreEl = detail.querySelector('.criterion-score');
                    const descriptionEl = detail.querySelector('.criterion-description');

                    nameEl.textContent = labels[index];
                    scoreEl.textContent = scores[index].toFixed(1);
                    descriptionEl.textContent = suggestions[index];
                }
            });

            // 更新總結區塊
            const summaryTitle = summarySection.querySelector('.summary-title');
            const summaryScore = summarySection.querySelector('.summary-score');
            const summaryContent = summarySection.querySelector('.summary-content');

            summaryTitle.textContent = '總體評價';
            summaryScore.textContent = scores[scores.length - 1].toFixed(1);
            summaryContent.textContent = suggestions[suggestions.length - 1];
        }

        // 更新總分的函數（與之前相同）
        function updateOverallScore(totalScore) {
            const finalScoreEl = document.querySelector('.final-score');
            finalScoreEl.textContent = totalScore.toFixed(1) + ' 分';
        }
    };
</script>

</html>